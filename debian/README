# Zonemaster LDNS packaging

How to build and upload deb packages to packages1.


## Requirements

    libdevel-checklib-perl
    libidn11-dev
    libmodule-install-perl
    libmodule-install-xsutil-perl


# Packaging

    # Setup variables
    VERSION=1.0.2-13-8e093fc
    REV=iis1

    # Build original tarball
    git clone https://github.com/dotse/zonemaster-ldns.git
    ( cd zonemaster-ldns ; git checkout 8e093fc )
    ( cd zonemaster-ldns ; git submodule update --init )
    mkdir zonemaster-ldns/inc/.author
    ( cd zonemaster-ldns ; perl Makefile.PL --no-internal-ldns )
    ( cd zonemaster-ldns ; make dist )
    tar xzf zonemaster-ldns/Zonemaster-LDNS-${VERSION/%-*/}.tar.gz
    rm -rf zonemaster-ldns
    mv Zonemaster-LDNS-${VERSION/%-*/} libzonemaster-ldns-perl-${VERSION}
    tar czf ../libzonemaster-ldns-perl_${VERSION}.orig.tar.gz libzonemaster-ldns-perl-${VERSION}
    rm -rf libzonemaster-ldns-perl-${VERSION}

    # **TODO:** Update git checkout command to use v${VERSION} instead of commit id

    # Extract original tarball
    tar xzf ../libzonemaster-ldns-perl_${VERSION}.orig.tar.gz --strip-components 1 --exclude .gitignore

    # Build source package
    dpkg-buildpackage -S -k92388F75

    # Build binary packages
    sudo DIST=precise cowbuilder --build ../libzonemaster-ldns-perl_${VERSION}-${REV}.dsc

    # Upload packages
    sudo -ubuild dput packages1-pdt ~/packages/libzonemaster-ldns-perl_${VERSION}-${REV}_amd64.changes

    # Tag release
    git tag ${VERSION}-${REV}
    git push --tags
